<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Media Universe Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #f0f0f0;
            overflow-x: hidden;
        }

        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }

        .search-container {
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-bar {
            background: rgba(20, 20, 25, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            background: rgba(25, 25, 30, 0.8);
            border-color: #4f46e5;
            box-shadow: 0 0 25px rgba(79, 70, 229, 0.5);
        }

        .page-card {
            background: linear-gradient(145deg, rgba(25, 25, 30, 0.8), rgba(15, 15, 20, 0.8));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        
        .result-card {
            background: linear-gradient(145deg, rgba(25, 25, 30, 0.8), rgba(15, 15, 20, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
        }

        .page-card:hover {
            transform: translateY(-10px) rotateX(5deg) scale(1.03);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 15px rgba(79, 70, 229, 0.3);
            border-color: rgba(79, 70, 229, 0.6);
        }
        
        .result-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            border-color: rgba(79, 70, 229, 0.6);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-card .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at var(--mouse-x) var(--mouse-y), rgba(79, 70, 229, 0.2), transparent 40%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .page-card:hover .card-glow {
            opacity: 1;
        }
        
        /* Watched indicator */
        .watched-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #4f46e5;
            color: white;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        /* Modal Styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        .modal-content {
             background: #1a1a1f;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111;
        }
        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }
    </style>
</head>
<body class="antialiased">
    <canvas id="particle-canvas"></canvas>

    <main class="container mx-auto px-4 py-8 md:py-16 relative z-10">
        <header id="header" class="text-center mb-12 transition-all duration-500">
            <h1 class="text-4xl md:text-6xl font-black tracking-tighter text-white">
                Media Universe <span class="text-indigo-500">Hub</span>
            </h1>
            <p class="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">
                Your central command for every movie, series, and franchise. Search everything in one place.
            </p>
        </header>

        <div id="search-container" class="search-container w-full max-w-3xl mx-auto mb-12">
            <div class="flex items-center gap-4">
                <div class="relative flex-grow">
                     <svg class="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="search-bar" class="search-bar w-full py-4 pl-12 pr-4 text-white rounded-full focus:outline-none" placeholder="Search for a movie or series...">
                </div>
                <button id="import-progress-button" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-6 rounded-full transition-colors duration-300 whitespace-nowrap">
                    Import Progress
                </button>
                <input type="file" id="import-file-input" class="hidden" accept=".json">
            </div>
        </div>

        <div id="content-area">
            <div id="page-links-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-8">
                <a href="MCU_Netflix.html" class="page-card block rounded-2xl overflow-hidden group perspective-1000">
                    <div class="relative p-6 h-full flex flex-col justify-between">
                         <div class="card-glow"></div>
                        <div><h2 class="text-2xl font-bold text-white">The Defenders Saga</h2><p class="text-gray-400 mt-2">Track your progress through Marvel's gritty Netflix series.</p></div>
                        <div class="mt-6 text-indigo-400 font-semibold group-hover:text-white transition-colors">View Timeline &rarr;</div>
                    </div>
                </a>
                <a href="Star_Wars.html" class="page-card block rounded-2xl overflow-hidden group perspective-1000">
                     <div class="relative p-6 h-full flex flex-col justify-between">
                         <div class="card-glow"></div>
                        <div><h2 class="text-2xl font-bold text-white">Star Wars Spinoffs</h2><p class="text-gray-400 mt-2">Dive into the animated shows and spinoffs of the galaxy far, far away.</p></div>
                         <div class="mt-6 text-indigo-400 font-semibold group-hover:text-white transition-colors">Discover More &rarr;</div>
                    </div>
                </a>
                <a href="watcher.html" class="page-card block rounded-2xl overflow-hidden group perspective-1000">
                     <div class="relative p-6 h-full flex flex-col justify-between">
                         <div class="card-glow"></div>
                        <div><h2 class="text-2xl font-bold text-white">Franchise Tracker</h2><p class="text-gray-400 mt-2">Keep track of major movie franchises like MCU, Transformers, and more.</p></div>
                         <div class="mt-6 text-indigo-400 font-semibold group-hover:text-white transition-colors">Track Franchises &rarr;</div>
                    </div>
                </a>
            </div>

            <div id="search-results-container" class="hidden">
                 <h2 id="results-title" class="text-2xl font-bold text-white mb-6">Search Results</h2>
                 <div id="results-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 sm:gap-6 items-start">
                 <p id="no-results-message" class="text-center text-gray-400 text-lg mt-8 hidden">No results found. Try a different search term.</p>
            </div>
        </div>
    </main>
    
    <div id="import-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay hidden">
        <div class="modal-content w-full max-w-md p-6 rounded-2xl shadow-lg border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Import Progress</h2>
                <button id="close-modal-button" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <p class="text-gray-400 mb-6">Select which watchlist you want to import a backup file for.</p>
            <div class="grid grid-cols-1 gap-4">
                <button data-key="marvelTimelineWatched" class="import-option-button w-full text-left p-4 bg-gray-800 hover:bg-indigo-600 rounded-lg transition-colors">The Defenders Saga</button>
                <button data-key="starWarsTimelineWatched" class="import-option-button w-full text-left p-4 bg-gray-800 hover:bg-indigo-600 rounded-lg transition-colors">Star Wars Spinoffs</button>
                <button data-key="franchiseTrackerWatched" class="import-option-button w-full text-left p-4 bg-gray-800 hover:bg-indigo-600 rounded-lg transition-colors">Franchise Tracker</button>
            </div>
        </div>
    </div>


    <script>
    // --- IMAGE PATH HANDLING ---
    // Function to ensure all image paths are properly formatted - same as in M&S&G.html
    function getImagePath(imageName) {
        if (!imageName) return '';
        
        // If the path already includes 'images/', return as is
        if (imageName.startsWith('images/')) return imageName;
        
        // Handle special case for The Raid Redemption which is actually a .jpg file
        if (imageName === 'The Raid Redemption (2011).jpg') {
            return 'images/' + imageName;
        }
        
        // Most of the images in the directory are .png format
        // If the name has .jpg extension, convert it to .png
        let path = 'images/' + imageName;
        if (path.endsWith('.jpg') || path.endsWith('.jpeg')) {
            path = path.replace(/\.(jpg|jpeg)$/, '.png');
        }
        
        return path;
    }
    
    // --- DATA AGGREGATION ---
    const allMediaData = [];

    // 1. Data from M&S&G.html (REMOVED)

    // 2. Data from MCU_Netflix.html
    const mcuNetflixData = [{title:"Daredevil",season:1,date:"April 10, 2015"},{title:"Jessica Jones",season:1,date:"November 20, 2015"},{title:"Daredevil",season:2,date:"March 18, 2016"},{title:"Luke Cage",season:1,date:"September 30, 2016"},{title:"Iron Fist",season:1,date:"March 17, 2017"},{title:"The Defenders",season:1,date:"August 18, 2017"},{title:"The Punisher",season:1,date:"November 17, 2017"},{title:"Jessica Jones",season:2,date:"March 8, 2018"},{title:"Luke Cage",season:2,date:"June 22, 2018"},{title:"Iron Fist",season:2,date:"September 7, 2018"},{title:"Daredevil",season:3,date:"October 19, 2018"},{title:"The Punisher",season:2,date:"January 18, 2019"},{title:"Jessica Jones",season:3,date:"June 14, 2019"}];
    mcuNetflixData.forEach(item => {
        allMediaData.push({
            id: `${item.title}-${item.season}`,
            title: `${item.title} - Season ${item.season}`,
            page: 'MCU_Netflix.html',
            category: 'The Defenders Saga',
            image: getImagePath(`${item.title} - Season ${item.season}.png`) // Using getImagePath for consistency
        });
    });

    // 3. Data from Star_Wars.html
    const starWarsData = [{title:"Star Wars Holiday Special",season:"TV Special",date:"Nov 17, 1978",image:"images/Star Wars Holiday Special - TV Special.png",description:"The infamous variety show featuring Chewbacca's family and musical performances."},{title:"The Ewok Adventure",season:"TV Film",date:"Nov 25, 1984",image:"images/The Ewok Adventure - TV Film.png",description:"The Towani family is stranded on Endor and needs the help of the Ewoks to find their parents."},{title:"Droids",season:"1 Season",date:"Sep 1985 - Jun 1986",image:"images/Droids - 1 Season.png",description:"The adventures of R2-D2 and C-3PO before they joined the Rebellion."},{title:"Ewoks",season:"2 Seasons",date:"Sep 1985 - Dec 1986",image:"images/Ewoks - 2 Seasons.png",description:"Follow the adventures of Wicket and his friends on the forest moon of Endor."},{title:"Ewoks The Battle for Endor",season:"TV Film",date:"Nov 24, 1985",image:"images/Ewoks The Battle for Endor - TV Film.png",description:"Cindel and the Ewoks must fight against evil marauders who have taken over Endor."},{title:"Clone Wars (2D Micro-Series)",season:"3 Seasons",date:"Nov 2003 - Mar 2005",image:"images/Clone Wars (2D Micro-Series) - 3 Seasons.png",description:"Genndy Tartakovsky's stylized take on the Clone Wars."},{title:"The Clone Wars",season:"Animated Film",date:"2008",image:"images/The Clone Wars - Animated Film.png",description:"Anakin and his new Padawan Ahsoka must rescue Jabba the Hutt's son."},{title:"The Clone Wars (Animated Series)",season:"7 Seasons",date:"Oct 2008 - May 2020",image:"images/The Clone Wars (Animated Series) - 7 Seasons.png",description:"The epic saga of the Clone Wars featuring Anakin, Obi-Wan, and Ahsoka."},{title:"Rebels",season:"4 Seasons",date:"Oct 2014 - Mar 2018",image:"images/Rebels - 4 Seasons.png",description:"The crew of the Ghost fights against the Empire in the early days of the Rebellion."},{title:"Blips",season:"1 Season",date:"May - Sep 2017",image:"images/Blips - 1 Season.png",description:"Short adventures featuring BB-8 and other droids from the sequel trilogy."},{title:"Forces of Destiny",season:"2 Seasons",date:"Jul 2017 - May 2018",image:"images/Forces of Destiny - 2 Seasons.png",description:"Short stories focusing on the heroines of Star Wars."},{title:"Resistance",season:"2 Seasons",date:"Oct 2018 - Jan 2020",image:"images/Resistance - 2 Seasons.png",description:"Kazuda Xiono becomes a spy for the Resistance against the First Order."},{title:"Galaxy of Adventures",season:"2 Seasons",date:"Nov 2018 - Oct 2020",image:"images/Galaxy of Adventures - 2 Seasons.png",description:"Reimagined classic Star Wars moments in a modern animation style."},{title:"Roll Out",season:"1 Season",date:"Aug 2019 - Apr 2020",image:"images/Roll Out - 1 Season.png",description:"Cute, spherical versions of Star Wars characters have mini-adventures."},{title:"The Bad Batch",season:"3 Seasons",date:"May 2021 - May 2024",image:"images/The Bad Batch - 3 Seasons.png",description:"Elite clone troopers with genetic mutations navigate the early Imperial era."},{title:"Visions",season:"2 Seasons",date:"Sep 2021 - Ongoing",image:"images/Visions - 2 Seasons.png",description:"Anime-inspired anthology series with unique takes on the Star Wars universe."},{title:"Galaxy of Creatures",season:"2 Seasons",date:"Oct 2021 - Feb 2023",image:"images/Galaxy of Creatures - 2 Seasons.png",description:"A droid explores and documents various creatures throughout the galaxy."},{title:"Galactic Pals",season:"1 Season",date:"Apr - Nov 2022",image:"images/Galactic Pals - 1 Season.png",description:"A caretaker droid looking after baby versions of Star Wars aliens."},{title:"Tales",season:"3 Seasons",date:"Oct 2022 - Ongoing",image:"images/Tales - 3 Seasons.png",description:"Anthology series exploring pivotal moments in characters' lives."},{title:"Zen - Grogu and the Dust Bunnies",season:"1 Short",date:"Nov 12, 2022",image:"images/Zen - Grogu and the Dust Bunnies - 1 Short.png",description:"A Studio Ghibli short featuring Grogu interacting with soot sprites."},{title:"Young Jedi Adventures",season:"2 Seasons",date:"May 2023 - Ongoing",image:"images/Young Jedi Adventures - 2 Seasons.png",description:"Younglings train in the ways of the Force during the High Republic era."},{title:"Fun with Nubs",season:"1 Season",date:"Jun 2024 - Ongoing",image:"images/Fun with Nubs - 1 Season.png",description:"The youngling Nubs gets into mischief while learning about the Force."}];
    starWarsData.forEach(item => {
        allMediaData.push({
            id: `${item.title}-${item.season}`,
            title: `${item.title} - ${item.season}`,
            page: 'Star_Wars.html',
            category: 'Star Wars Animated & Spinoffs',
            image: getImagePath(item.image) // Using getImagePath for consistency
        });
    });

    // 4. Data from watcher.html
    const watcherData = {marvel_cinematic_universe:{name:"Marvel Cinematic Universe",color:"from-red-500 to-red-600",items:[{id:"mcu1",title:"Agents of S.H.I.E.L.D. season 2",type:"ABC series",year:"2014-2015"},{id:"mcu2",title:"Agent Carter season 1",type:"ABC series",year:"2015"},{id:"mcu4",title:"Agents of S.H.I.E.L.D. season 3",type:"ABC series",year:"2015-2016"},{id:"mcu6",title:"Agent Carter season 2",type:"ABC series",year:"2016"},{id:"mcu8",title:"Agents of S.H.I.E.L.D. season 4",type:"ABC series",year:"2016-2017",note:"Watch Slingshot after S4.E8"},{id:"mcu9",title:"Agents of S.H.I.E.L.D.: Slingshot",type:"Web series",year:"2016"},{id:"mcu15",title:"Runaways season 1",type:"Young adult series",year:"2017-2018"},{id:"mcu16",title:"Agents of S.H.I.E.L.D. season 5",type:"ABC series",year:"2017-2018"},{id:"mcu18",title:"Cloak & Dagger season 1",type:"Young adult series",year:"2018"},{id:"mcu22",title:"Runaways season 2",type:"Young adult series",year:"2018"},{id:"mcu24",title:"Cloak & Dagger season 2",type:"Young adult series",year:"2019"},{id:"mcu25",title:"Agents of S.H.I.E.L.D. season 6",type:"ABC series",year:"2019"},{id:"mcu27",title:"Runaways season 3",type:"Young adult series",year:"2019"},{id:"mcu28",title:"Agents of S.H.I.E.L.D. season 7",type:"ABC series",year:"2020"},{id:"mcu29",title:"Helstrom season 1",type:"Adventure into Fear series",year:"2020"},{id:"mcu30",title:"Captain America: Brave New World",type:"Film",year:"2025"},{id:"mcu31",title:"Daredevil: Born Again season 1",type:"Phase Five series",year:"2025 (Expected)"},{id:"mcu32",title:"Thunderbolts*",type:"Film",year:"2025",alternateImageName:"Thunderbolts"},{id:"mcu33",title:"Ironheart season 1",type:"Phase Five series",year:"2025 (Expected)"},{id:"mcu34",title:"The Fantastic Four",type:"Film",year:"2025"},{id:"mcu36",title:"Marvel Zombies season 1",type:"Phase Six series",year:"2025 (Expected)"},{id:"mcu37",title:"Wonder Man season 1",type:"Phase Six series",year:"2025 (Expected)"}]},transformers:{name:"Transformers",color:"from-purple-500 to-indigo-600",items:[{id:"t1",title:"Transformers: Beginnings",type:"Short film",year:"2007"},{id:"t2",title:"Transformers: Cyber Missions",type:"Web series",year:"2010"},{id:"t3",title:"Transformers: The Last Knight",type:"Film",year:"2017"},{id:"t4",title:"Bumblebee",type:"Film",year:"2018"},{id:"t5",title:"Bumblebee's First Life on Earth",type:"Web series",year:"2019"},{id:"t6",title:"Agent Burns: Welcome to Sector 7",type:"Short film",year:"2019"},{id:"t7",title:"Sector 7 Adventures: The Battle at Half Dome",type:"Short film",year:"2019"},{id:"t8",title:"Transformers: Rise of the Beasts",type:"Film",year:"2023"}]},fast_furious:{name:"Fast & Furious",color:"from-orange-500 to-red-600",items:[{id:"ff1",title:"The Turbo Charged Prelude for 2 Fast 2 Furious",type:"Short film",year:"2003"},{id:"ff2",title:"2 Fast 2 Furious",type:"Film",year:"2003"},{id:"ff3",title:"The Fast and the Furious: Tokyo Drift",type:"Film",year:"2006"},{id:"ff4",title:"Fast & Furious",type:"Film",year:"2009"},{id:"ff5",title:"Los Bandoleros",type:"Short film",year:"2009"},{id:"ff6",title:"Fast Five",type:"Film",year:"2011"},{id:"ff7",title:"Fast & Furious 6",type:"Film",year:"2013"},{id:"ff8",title:"Furious 7",type:"Film",year:"2015"},{id:"ff9",title:"The Fate of the Furious",type:"Film",year:"2017"},{id:"ff10",title:"Hobbs & Shaw",type:"Film",year:"2019"},{id:"ff11",title:"F9",type:"Film",year:"2021"},{id:"ff12",title:"Fast X",type:"Film",year:"2023"}]},jurassic_park:{name:"Jurassic Park",color:"from-green-500 to-teal-600",items:[{id:"jp2",title:"Jurassic World: Fallen Kingdom",type:"Film",year:"2018"},{id:"jp3",title:"Battle at Big Rock",type:"Short film",year:"2019"},{id:"jp4",title:"Jurassic World Dominion prologue",type:"Short film",year:"2021"},{id:"jp5",title:"Jurassic World Dominion",type:"Film",year:"2022"},{id:"jp6",title:"Jurassic World Rebirth",type:"Film",year:"2025"}]}};
    Object.values(watcherData).forEach(franchise => {
        franchise.items.forEach(item => {
            const imageTitle = (item.alternateImageName || item.title).replace(/:/g, '').replace(/'/g, '\'').replace(/\*/g, '');
            allMediaData.push({
                ...item,
                page: 'watcher.html',
                category: franchise.name,
                image: getImagePath(`${imageTitle}.png`) // Using getImagePath for consistency
            });
        });
    });

    let allWatchedStates = {};
    let selectedStorageKey = '';

    // --- DOM ELEMENTS ---
    const searchBar = document.getElementById('search-bar');
    const pageLinksContainer = document.getElementById('page-links-container');
    const searchResultsContainer = document.getElementById('search-results-container');
    const resultsGrid = document.getElementById('results-grid');
    const noResultsMessage = document.getElementById('no-results-message');
    const header = document.getElementById('header');
    const searchContainer = document.getElementById('search-container');
    const resultsTitle = document.getElementById('results-title');
    const importButton = document.getElementById('import-progress-button');
    const fileInput = document.getElementById('import-file-input');
    const importModal = document.getElementById('import-modal');
    const closeModalButton = document.getElementById('close-modal-button');

    // --- WATCHED STATE MANAGEMENT ---
    function loadAllWatchedStates() {
        const keys = ['marvelTimelineWatched', 'starWarsTimelineWatched', 'franchiseTrackerWatched'];
        allWatchedStates = {};
        keys.forEach(key => {
            try {
                const data = JSON.parse(localStorage.getItem(key) || '{}');
                Object.assign(allWatchedStates, data);
            } catch (e) {
                console.error(`Error parsing data from ${key}:`, e);
            }
        });
    }

    // --- SEARCH FUNCTIONALITY ---
    searchBar.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();

        if (query.length > 0) {
            pageLinksContainer.classList.add('hidden');
            searchResultsContainer.classList.remove('hidden');
            header.classList.add('md:-translate-y-16');
            searchContainer.classList.add('md:-translate-y-8');
            const filteredResults = allMediaData.filter(item => item.title.toLowerCase().includes(query));
            displayResults(filteredResults, query);
        } else {
            pageLinksContainer.classList.remove('hidden');
            searchResultsContainer.classList.add('hidden');
            header.classList.remove('md:-translate-y-16');
            searchContainer.classList.remove('md:-translate-y-8');
        }
    });

    function displayResults(results, query) {
    resultsGrid.innerHTML = '';
    if (results.length === 0) {
        noResultsMessage.classList.remove('hidden');
    } else {
        noResultsMessage.classList.add('hidden');
        resultsTitle.innerHTML = `${results.length} results for "<span class="text-indigo-400">${query}</span>"`;
        results.forEach((item, index) => {
            const isWatched = allWatchedStates[item.id] === true;
            const card = document.createElement('a');
            card.href = `${item.page}#item=${item.id}`; // Link to the page with a hash for highlighting
            // REMOVED 'h-full' to prevent stretching and allow 'items-start' on the grid to work correctly.
            card.className = 'result-card flex flex-col rounded-xl overflow-hidden group';
            card.style.animationDelay = `${index * 0.05}s`;

            const placeholder = `https://via.placeholder.com/300x169/1a1a1f/ffffff?text=${encodeURIComponent(item.title.substring(0, 15))}`;
            
            card.innerHTML = `
                <div class="relative overflow-hidden bg-gray-900/50 aspect-w-16 aspect-h-9">
                    <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" loading="lazy" onerror="this.onerror=null; this.src='${placeholder}';">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                    ${isWatched ? '<div class="watched-indicator"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><polyline points="20 6 9 17 4 12"></polyline></svg>Watched</div>' : ''}
                </div>
                <div class="p-3 mt-auto"> 
                    <h3 class="text-sm font-bold text-white truncate group-hover:text-indigo-300" title="${item.title}">${item.title}</h3>
                    <p class="text-xs text-gray-400 truncate">${item.category}</p>
                </div>
            `;
            resultsGrid.appendChild(card);
        });
    }
}




    // --- IMPORT MODAL FUNCTIONALITY ---
    importButton.addEventListener('click', () => importModal.classList.remove('hidden'));
    closeModalButton.addEventListener('click', () => importModal.classList.add('hidden'));
    importModal.addEventListener('click', (e) => {
        if (e.target === importModal) {
            importModal.classList.add('hidden');
        }
    });

    document.querySelectorAll('.import-option-button').forEach(button => {
        button.addEventListener('click', (e) => {
            selectedStorageKey = e.target.dataset.key;
            fileInput.click();
        });
    });

    fileInput.addEventListener('change', handleFileUpload);

    function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file || !selectedStorageKey) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                 if (!importedData.watchedData) {
                    throw new Error("Backup file is missing 'watchedData'.");
                }
                
                localStorage.setItem(selectedStorageKey, JSON.stringify(importedData.watchedData));
                loadAllWatchedStates();
                
                if(searchBar.value) {
                     const query = searchBar.value.toLowerCase().trim();
                     const filteredResults = allMediaData.filter(item => item.title.toLowerCase().includes(query));
                     displayResults(filteredResults, query);
                }
                alert('Progress for ' + selectedStorageKey + ' imported successfully!');

            } catch (err) {
                console.error("Import failed:", err);
                alert(`Import failed: ${err.message}`);
            } finally {
                event.target.value = '';
                selectedStorageKey = '';
                importModal.classList.add('hidden');
            }
        };
        reader.readAsText(file);
    }


    // --- PARTICLE BACKGROUND ---
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    const particleCount = 60;

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 0.5;
            this.vy = (Math.random() - 0.5) * 0.5;
            this.radius = Math.random() * 1.5 + 0.5;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
        }
        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(79, 70, 229, 0.8)';
            ctx.fill();
        }
    }

    function initParticles() {
        resizeCanvas();
        particles = [];
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
    }

    function animateParticles() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
            p.update();
            p.draw();
        });

        for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
                const dx = particles[i].x - particles[j].x;
                const dy = particles[i].y - particles[j].y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < 150) {
                    ctx.beginPath();
                    ctx.moveTo(particles[i].x, particles[i].y);
                    ctx.lineTo(particles[j].x, particles[j].y);
                    ctx.strokeStyle = `rgba(79, 70, 229, ${1 - distance / 150})`;
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }
        }
        requestAnimationFrame(animateParticles);
    }
    
    // --- MOUSE GLOW EFFECT ON PAGE CARDS ---
    document.querySelectorAll('.page-card').forEach(card => {
        card.addEventListener('mousemove', e => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            card.style.setProperty('--mouse-x', `${x}px`);
            card.style.setProperty('--mouse-y', `${y}px`);
        });
    });

    // --- INITIALIZATION ---
    window.addEventListener('DOMContentLoaded', () => {
         window.addEventListener('resize', initParticles);
         initParticles();
         animateParticles();
         loadAllWatchedStates();
    });
</script>
</body>
</html>
